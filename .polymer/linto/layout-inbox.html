<dom-module id="layout-inbox">

    <style>
    paper-drawer-panel /deep/ #drawer,
    paper-drawer-panel /deep/ #main #scrim {
        z-index: 1;
    }
    
    paper-toggle-button {
        --paper-toggle-button-checked-bar-color: var(--paper-green-500);
        --paper-toggle-button-checked-button-color: var(--paper-green-500);
        --paper-toggle-button-checked-ink-color: var(--paper-green-500);
    }
    
    .menu-li {
        border-bottom: 2px solid #EEE;
        border-top: 2px solid #EEE;
    }
    
    .undo {
        display: none!important;
    }
    </style>

    <template>
        <paper-drawer-panel id="drawer">
            <paper-header-panel drawer>
                <div class="fit layout vertical">
                    <!-- <template if="[[user._id]]" is="dom-if">
                        <div class="cursor-p horizontal hover layout menu-li relative" on-click="user_prompt">
                            <div style="padding: 16px; padding-right: 8px;">
                                <selectable-icon icon_img_src$="[[user.profile.picture]]"></selectable-icon>
                            </div>

                            <div class="flex layout vertical" style="padding: 16px; padding-left: 8px;">
                                <div class="horizontal layout">
                                    <div class="etc flex self-center" style="font-size: 16px; line-height: 24px;">[[user.profile.name]]</div>
                                    <div class="self-start" style="color: #757575; font-size: 14px; line-height: 20px;">[[return_text(project.length)]]</div>
                                </div>
                                <div class="etc" style="color: #757575; font-size: 14px; line-height: 20px;">[[user.profile.email]]</div>
                            </div>

                            <paper-ripple></paper-ripple>
                        </div>
                    </template> -->

                    <div class="flex" style="overflow: auto;">
                        <!-- <iron-selector activate-event="click" id="menu_opt" on-iron-select="menu_opt" selected-attribute="selected">
                            <div class="cursor-p horizontal hover layout menu-li relative" data-id="trend">
                                <div style="padding: 16px; padding-right: 8px;">
                                    <selectable-icon icon_class="cyan-700" icon_text="@"></selectable-icon>
                                </div>

                                <div class="flex layout vertical" style="padding: 16px; padding-left: 8px;">
                                    <div class="horizontal layout">
                                        <div class="etc flex self-center" style="font-size: 16px; line-height: 24px;">Trending</div>
                                        <div class="self-start" style="color: #757575; font-size: 14px; line-height: 20px;">[[return_text(trend.keyword.length)]]</div>
                                    </div>
                                    <div class="etc" style="color: #757575; font-size: 14px; line-height: 20px;">[[return_time_s(trend.time)]]</div>
                                </div>

                                <paper-ripple></paper-ripple>
                            </div>

                            <template is="dom-repeat" items="[[project]]">
                                <div class="cursor-p horizontal hover layout menu-li relative" data-id$="[[item._id]]">
                                    <div style="padding: 16px; padding-right: 8px;">
                                        <selectable-icon icon_class$="[[return_class(item.keyword)]]" icon_text$="[[return_icon_text(item.keyword)]]"></selectable-icon>
                                    </div>

                                    <div class="flex layout vertical" style="padding: 16px; padding-left: 8px;">
                                        <div class="horizontal layout">
                                            <div class="etc flex self-center" style="font-size: 16px; line-height: 24px;">[[item.keyword]]</div>
                                            <div class="self-start" style="color: #757575; font-size: 14px; line-height: 20px;">[[return_torrent_count(item.torrent)]]</div>
                                        </div>
                                        <div class="etc" style="color: #757575; font-size: 14px; line-height: 20px;">[[return_project_description(item)]]</div>
                                    </div>

                                    <paper-ripple></paper-ripple>
                                </div>
                            </template>
                        </iron-selector> -->
                    </div>

                    <div class="cursor-p menu-li relative white" onclick="window.open('http://vcompile.com/Patentability', '_system')" style="padding: 16px; z-index: 1;">About Patentability
                        <paper-ripple></paper-ripple>
                    </div>
                </div>
            </paper-header-panel>

            <neon-animated-pages class="fit" id="main-page" main selected="2">
                <neon-animatable>
                    <!-- <paper-header-panel>
                            <div class="center-justified horizontal layout">
                                <div class="center cursor-d horizontal layout li" style="padding: 8px;">
                                    <iron-icon icon="trending-up" style="padding: 8px;"></iron-icon>
                                    <div style="border-bottom: 2px solid #AAA; line-height: 24px; padding: 8px;">Trending Top <span>[[return_text(trend.keyword.length)]]</span></div>
                                </div>
                            </div>

                            <div class="center-justified horizontal layout">
                                <div class="horizontal layout li wrap" style="padding: 4px 12px;">
                                    <template is="dom-repeat" items="[[trend.keyword]]">
                                        <div class="cursor-p grey-500" on-click="trend_opt" style="margin: 4px; padding: 8px 12px;">[[item]]</div>
                                    </template>
                                </div>
                            </div>

                            <div style="min-height: 80px;"></div>
                        </paper-header-panel> -->
                </neon-animatable>

                <inbox-view id="inbox-view"></inbox-view>
                <patent-view id="patent-view"></patent-view>
            </neon-animated-pages>
        </paper-drawer-panel>

        <!-- <paper-dialog id="user_prompt" style="width: 320px;" with-backdrop>
            <div class="layout vertical">
                <div style="border-bottom: 2px solid #888; margin: 8px 0; padding: 4px 0;">alerter</div>

                <div class="center horizontal justified layout" style="padding: 8px 0;">
                    <div style="color: #757575;">enable GCM</div>
                    <paper-toggle-button checked disabled></paper-toggle-button>
                </div>

                <div class="center horizontal justified layout" style="padding: 8px 0;">
                    <div style="color: #757575;">enable email alert</div>
                    <paper-toggle-button disabled></paper-toggle-button>
                </div>

                <div style="border-bottom: 2px solid #888; margin: 8px 0; padding: 4px 0;">scheduler</div>

                <div class="center horizontal layout">
                    <div class="flex" style="color: #757575;">schedule / day</div>
                    <paper-slider disabled editable id="seeds" max="96" min="1" style="max-width: 100px;" value="4"></paper-slider>
                </div>

                <div style="border-bottom: 2px solid #888; margin: 8px 0; padding: 4px 0;">user: <span>[[user.profile.name]]</span></div>

                <div class="end-justified horizontal layout">
                    <paper-button class="blue-500" on-click="sign_out" style="margin: 8px 0; width: 50%;">SIGN OUT</paper-button>
                </div>
            </div>
        </paper-dialog> -->

        <!-- <paper-dialog id="remove_prompt" style="width: 320px;" with-backdrop>
            <div>Are you sure to delete this item ?</div>

            <div class="buttons">
                <paper-button onclick="document.querySelector('#remove_prompt').close();">
                    <iron-icon icon="close"></iron-icon>
                    cancel
                </paper-button>
                <paper-button on-click="remove_ok">
                    <iron-icon icon="check"></iron-icon>
                    ok
                </paper-button>
            </div>
        </paper-dialog> -->

        <!-- <paper-dialog id="schedule_prompt" style="width: 320px;" with-backdrop>
            <div>Are you sure to schedule this item ?</div>

            <div class="buttons">
                <paper-button onclick="document.querySelector('#schedule_prompt').close();">
                    <iron-icon icon="close"></iron-icon>
                    cancel
                </paper-button>
                <paper-button on-click="schedule_ok">
                    <iron-icon icon="check"></iron-icon>
                    ok
                </paper-button>
            </div>
        </paper-dialog> -->
    </template>

    <script>
    Polymer({

        // add_project: function() {
        //     FlowRouter.setQueryParams({
        //         "route": "add-project"
        //     });
        // },

        // attached: function() {
        //     this.user = (Meteor.user() ? Meteor.user() : {});

        //     if ((document.querySelector("#torrent_db").value || []).length) {
        //         this.project = document.querySelector("#torrent_db").value;
        //     }

        //     var _this = this;

        //     Meteor.setTimeout(function() {
        //         if (6 < moment.duration(moment().diff(moment(_this.trend.time))).asHours() || !_this.trend.keyword.length) {
        //             Meteor.call("trend", function(error, response) {
        //                 if (error) {
        //                     document.querySelector("#polymer_toast").toast(error.reason);
        //                 } else {
        //                     if (response.length) {
        //                         _this.trend = {
        //                             keyword: response,
        //                             time: moment().format()
        //                         };
        //                     }
        //                 }
        //             });
        //         }
        //     }, 1000);

        //     Meteor.setTimeout(function() {
        //         _project.find().observe({
        //             added: function(row) {
        //                 for (var A = 0; A < row.torrent.length; A++) {
        //                     var item = _torrent.findOne({
        //                         _id: row.torrent[A]
        //                     });

        //                     row.torrent[A] = (item ? item : {
        //                         _id: row.torrent[A]
        //                     });

        //                     row.torrent[A].project = {
        //                         _id: row._id
        //                     };
        //                 }

        //                 var index = _.map(_this.project, function(A) {
        //                     return A._id;
        //                 }).indexOf(row._id);

        //                 if (index == -1) {
        //                     _this.project.unshift(row);
        //                 } else {
        //                     // _this.project[index] = row;
        //                     // _this.project[index] = _.clone(_this.project[index]);
        //                 }

        //                 _this.project = _.clone(_this.project);
        //             },

        //             changed: function(row, old) {
        //                 for (var A = 0; A < row.torrent.length; A++) {
        //                     var item = _torrent.findOne({
        //                         _id: row.torrent[A]
        //                     });

        //                     row.torrent[A] = (item ? item : {
        //                         _id: row.torrent[A]
        //                     });

        //                     row.torrent[A].project = {
        //                         _id: row._id
        //                     };
        //                 }

        //                 var index = _.map(_this.project, function(A) {
        //                     return A._id;
        //                 }).indexOf(row._id);

        //                 if (-1 < index) {
        //                     _this.project[index] = row;
        //                     _this.project = _.clone(_this.project);
        //                 }
        //             },

        //             removed: function(old) {
        //                 var index = _.map(_this.project, function(A) {
        //                     return A._id;
        //                 }).indexOf(old._id);

        //                 if (-1 < index) {
        //                     _this.project.splice(index, 1);
        //                     _this.project = _.clone(_this.project);
        //                 }
        //             }
        //         });
        //     }, 1000);

        //     Meteor.setTimeout(function() {
        //         _torrent.find().observe({
        //             added: function(row) {
        //                 for (var A = 0; A < _this.project.length; A++) {
        //                     var index = _.map(_this.project[A].torrent, function(item) {
        //                         return item._id;
        //                     }).indexOf(row._id);

        //                     if (-1 < index) {
        //                         _this.project[A].torrent[index] = _.clone($.extend(true, _this.project[A].torrent[index], row));
        //                         _this.project[A].torrent = _.clone(_this.project[A].torrent);
        //                         _this.project[A] = _.clone(_this.project[A]);
        //                         _this.project = _.clone(_this.project);
        //                     }
        //                 }
        //             },

        //             changed: function(row, old) {
        //                 for (var A = 0; A < _this.project.length; A++) {
        //                     var index = _.map(_this.project[A].torrent, function(item) {
        //                         return item._id;
        //                     }).indexOf(row._id);

        //                     if (-1 < index) {
        //                         _this.project[A].torrent[index] = _.clone($.extend(true, _this.project[A].torrent[index], row));
        //                         _this.project[A].torrent = _.clone(_this.project[A].torrent);
        //                         _this.project[A] = _.clone(_this.project[A]);
        //                         _this.project = _.clone(_this.project);
        //                     }
        //                 }
        //             },

        //             removed: function(old) {
        //                 for (var A = 0; A < _this.project.length; A++) {
        //                     var index = _.map(_this.project[A].torrent, function(item) {
        //                         return item._id;
        //                     }).indexOf(old._id);

        //                     if (-1 < index) {
        //                         _this.project[A].torrent.splice(index, 1);
        //                         _this.project[A].torrent = _.clone(_this.project[A].torrent);
        //                         _this.project[A] = _.clone(_this.project[A]);
        //                         _this.project = _.clone(_this.project);
        //                     }
        //                 }
        //             }
        //         });
        //     }, 1000 * 4);
        // },

        // clear_torrent_selection: function() {
        //     this.torrent_selected = [];
        // },

        // initialize_trend: function() {
        //     this.trend = {
        //         keyword: [],
        //         time: moment().format()
        //     };
        // },

        is: "layout-inbox",

        // is_search: function(worker) {
        //     return (worker == "search")
        // },

        // menu_opt: function(e, d) {
        //     this.$.drawer.closeDrawer();

        //     this.$.main_toolbar.className = this.$.main_toolbar.className.replace(/ ?[a-z\-]+\-500/g, "") + (d.item.dataset.id == "trend" ? "" : " " + document.querySelector("#menu_opt .iron-selected selectable-icon").icon_class);

        //     this.$.main_page.selected = (d.item.dataset.id == "trend" ? 0 : 1);

        //     this.menu_selected = d.item.dataset.id;
        // },

        menu_toggle: function() {
            if (this.$.drawer.narrow && this.$.drawer.getBoundingClientRect().width < parseInt(this.$.drawer.responsiveWidth)) {
                this.$.drawer.togglePanel();
            } else {
                this.$.drawer.forceNarrow = !this.$.drawer.forceNarrow;
            }
        },

        // observers: [
        //     // "project_change(project.splices)",
        //     "torrent_selected_change(torrent_selected.splices)"
        // ],

        // project_change: function(change) {
        //     this.debounce("project_change", function() {
        //         if (this.menu_selected != "trend") {
        //             this.$.main_page.selected = (this.project.length ? 1 : 0);
        //         }
        //     }, 1000 * 4);
        // },

        // project_selected: function(menu_opt, project_opt) {
        //     return (menu_opt == "" ? true : menu_opt == project_opt);
        // },

        // properties: {
        //     menu_selected: {
        //         type: String,
        //         value: ""
        //     },
        //     project: {
        //         type: Array,
        //         value: function() {
        //             return [];
        //         }
        //     },
        //     torrent_selected: {
        //         type: Array,
        //         value: function() {
        //             return [];
        //         }
        //     },
        //     trend: {
        //         type: Object,
        //         value: function() {
        //             return {
        //                 keyword: [],
        //                 time: moment().format()
        //             };
        //         }
        //     },
        //     user: {
        //         type: Object,
        //         value: function() {
        //             return {};
        //         }
        //     }
        // },

        // refresh: function(e) {
        //     if (Meteor.status().connected) {
        //         var _this = this;

        //         Meteor.call("refresh", Polymer.dom(e).localTarget.dataset.id, function(error, response) {
        //             if (error) {
        //                 document.querySelector("#polymer_toast").toast(error.reason);
        //             } else {
        //                 var index = _.map(_this.project, function(A) {
        //                     return A._id;
        //                 }).indexOf(response._id);

        //                 if (-1 < index) {
        //                     for (var A = 0; A < response.torrent.length; A++) {
        //                         var item = _torrent.findOne({
        //                             _id: response.torrent[A]
        //                         });

        //                         response.torrent[A] = (item ? item : {
        //                             _id: response.torrent[A]
        //                         });

        //                         response.torrent[A].project = {
        //                             _id: response._id
        //                         };
        //                     }

        //                     _this.project[index] = response;
        //                     _this.project = _.clone(_this.project);
        //                 }
        //             }
        //         });
        //     } else {
        //         document.querySelector("#polymer_toast").toast("server connection required");
        //     }
        // },

        // remove_ok: function(e) {
        //     if (Meteor.status().connected) {
        //         var _this = this;

        //         Meteor.call("remove_project", _this.$.remove_prompt.dataset.id, function(error, response) {
        //             if (error) {
        //                 document.querySelector("#polymer_toast").toast(error.reason);
        //             } else {
        //                 document.querySelector("#polymer_toast").toast(response);

        //                 _this.$.main_toolbar.className = _this.$.main_toolbar.className.replace(/ ?[a-z\-]+\-500/g, "");

        //                 _this.menu_selected = "";
        //             }
        //         });
        //     } else {
        //         document.querySelector("#polymer_toast").toast("server connection required");
        //     }

        //     this.$.remove_prompt.close();
        // },

        // remove_project: function(e) {
        //     this.$.remove_prompt.dataset.id = Polymer.dom(e).localTarget.dataset.id;
        //     this.$.remove_prompt.open();
        // },

        // remove_torrent: function() {
        //     $("inbox-item.iron-selected").addClass("undo");

        //     document.querySelector("#polymer_toast").undo = {
        //         torrent: _.map(this.torrent_selected, function(A) {
        //             return A._id;
        //         })
        //     };

        //     document.querySelector("#polymer_toast").toast(this.torrent_selected.length + " torrent removed");

        //     this.clear_torrent_selection();
        // },

        // return_class: function(text) {
        //     return polymer_color(text ? text : "#");
        // },

        // return_icon_text: function(text) {
        //     return (isNaN(text.charAt(0)) ? text.charAt(0) : "#");
        // },

        // return_project_description: function(item) {
        //     return (item.worker == "schedule" ? item.within + "M | " + item.leech + "L / " + item.seed + "S" : moment(item.time).format("MMM DD ddd hh:mm A"));
        // },

        // return_text: function(text) {
        //     return (text ? text : "#");
        // },

        // return_time: function(time) {
        //     return (moment(time).isValid() ? moment(time).fromNow() : "#");
        // },

        // return_time_s: function(time) {
        //     return (moment(time).isValid() ? moment(time).format("MMM DD ddd hh:mm A") : "#");
        // },

        // return_torrent_count: function(torrent) {
        //     var A = _.countBy(torrent, function(item) {
        //         return item.url ? "YES" : "NO";
        //     });

        //     return (A.YES && A.NO ? A.YES + " / " : "") + (torrent.length ? torrent.length : "#");
        // },

        // return_torrent_description: function(item) {
        //     return (item.size ? item.size : "#") + " | " + (item.leech ? item.leech + "L" : "#") + " / " + (item.seed ? item.seed + "S" : "#");
        // },

        // schedule: function(e) {
        //     this.$.schedule_prompt.dataset.id = Polymer.dom(e).localTarget.dataset.id;
        //     this.$.schedule_prompt.open();
        // },

        // schedule_ok: function(e) {
        //     if (Meteor.status().connected) {
        //         var _this = this;

        //         Meteor.call("schedule_project", _this.$.schedule_prompt.dataset.id, function(error, response) {
        //             if (error) {
        //                 document.querySelector("#polymer_toast").toast(error.reason);
        //             } else {
        //                 document.querySelector("#polymer_toast").toast(response);

        //                 _this.$.main_toolbar.className = _this.$.main_toolbar.className.replace(/ ?[a-z\-]+\-500/g, "");

        //                 _this.menu_selected = "";
        //             }
        //         });
        //     } else {
        //         document.querySelector("#polymer_toast").toast("server connection required");
        //     }

        //     this.$.schedule_prompt.close();
        // },

        // search_bar: function() {
        //     FlowRouter.setQueryParams({
        //         "route": "search-bar"
        //     });
        // },

        // share: function() {
        //     var body = "";

        //     for (var A = 0; A < this.torrent_selected.length; A++) {
        //         if (this.torrent_selected[A].link.length) {
        //             body += "\n\n" + (A + 1) + "\t\t" + this.torrent_selected[A].title + "\n\n";

        //             this.torrent_selected[A].link = _.sortBy(this.torrent_selected[A].link, "time");

        //             for (var Z = 0; Z < this.torrent_selected[A].link.length; Z++) {
        //                 body += "\t\t" + (Z + 1) + "\t\t" + this.torrent_selected[A].link[Z].url + "\n\n";
        //             }
        //         }
        //     }

        //     if (body != "") {
        //         if (Meteor.isCordova) {
        //             window.plugins.socialsharing.share("Hi\n\nPatentability - " + this.user.profile.name + " shared " + this.torrent_selected.length + " torrent" + body);
        //         } else {
        //             window.open("mailto:" + this.user.profile.email + "?subject=" + encodeURIComponent("Patentability") + "&body=" + encodeURIComponent("Hi\n\n" + this.user.profile.name + " shared " + this.torrent_selected.length + " torrent" + body), "_system");
        //         }
        //     } else {
        //         document.querySelector("#polymer_toast").toast("empty email body");
        //     }
        // },

        // sign_out: function() {
        //     if (Meteor.status().connected) {
        //         this.project = [];

        //         FlowRouter.go("/inbox/sign-out");
        //     } else {
        //         document.querySelector("#polymer_toast").toast("server connection required");
        //     }
        // },

        // sort: function(e) {
        //     var A = Polymer.dom(e).localTarget.dataset.index;

        //     this.project[A].torrent = _.sortBy(this.project[A].torrent, "time").reverse();
        //     this.project[A] = _.clone(this.project[A]);
        //     this.project = _.clone(this.project);

        //     document.querySelector("#polymer_toast").toast("sorted by time");
        // },

        // torrent_selected_change: function(change) {
        //     this.$.main_toolbar_title.textContent = (this.torrent_selected.length ? this.torrent_selected.length : "Patentability");

        //     this.$.main_toolbar.toggleClass("grey-500", this.torrent_selected.length);
        //     this.$.main_toolbar.toggleClass("selection", this.torrent_selected.length);

        //     this.$.fab.toggleClass("move-down", this.torrent_selected.length);
        // },

        // trend_opt: function(e) {
        //     if (Meteor.status().connected) {
        //         var keyword = Polymer.dom(e).localTarget.textContent.trim();

        //         if (keyword.length) {
        //             var _this = this,
        //                 row = {
        //                     keyword: keyword,
        //                     leech: 1,
        //                     seed: 1,
        //                     url: "search",
        //                     within: 6,
        //                     worker: "search"
        //                 };

        //             Meteor.call("insert_project", row, function(error, response) {
        //                 if (error) {
        //                     document.querySelector("#polymer_toast").toast((error.reason == "userNotFound") ? "internet/user required" : error.reason);
        //                 } else {
        //                     if (response == "") {
        //                         document.querySelector("#polymer_toast").toast("unknown issue");
        //                     } else {
        //                         document.querySelector("#polymer_toast").toast("i keyword added");

        //                         _this.$.main_toolbar.className = _this.$.main_toolbar.className.replace(/ ?[a-z\-]+\-500/g, "") + " " + polymer_color(keyword);

        //                         _this.menu_selected = response;
        //                     }
        //                 }
        //             });

        //             _this.$.main_page.selected = 1;
        //         } else {
        //             document.querySelector("#polymer_toast").toast("empty keyword");
        //         }
        //     } else {
        //         document.querySelector("#polymer_toast").toast("server connection required");
        //     }
        // },

        // user_prompt: function() {
        //     this.$.user_prompt.open();
        // }

    });
    </script>

</dom-module>
